- name: Disable all IBM repositories
  shell: yum-config-manager --disable 'public.dhe.ibm.com*'
  when: ansible_distribution in ['CentOS', 'RHEL']

- name: Update packages and kernel to latest available versions
  package:
    name: '*'
    state: latest
  when: 
   - ansible_pkg_mgr in ['yum', 'dnf']
   - update_os_packages | bool
   
- name: Install kernel-modules-extra package for br_netfilter module
  package:
    name: kernel-modules-extra
    state: present
  when:
    - ansible_pkg_mgr in ['yum', 'dnf']
    - ansible_distribution_major_version | int >= 10

- name: Check if reboot required
  shell: needs-restarting -r
  register: reboot_check
  ignore_errors: yes
  when: ansible_distribution in ['CentOS', 'RedHat']
